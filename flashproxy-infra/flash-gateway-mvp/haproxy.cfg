global
    log stdout format raw local0
    nbthread 2
    maxconn 200000

defaults
    mode http
    timeout connect  5s
    timeout client   4m
    timeout server   4m
    option          dontlognull

###############################################################################
# Front-end  :443  – public HTTPS-CONNECT gateway
###############################################################################
frontend edge_in
    bind :443
    mode http

    # ── 1 Gb/s per-IP bandwidth cap ───────────────────────────────────────────
    stick-table type ip size 1m expire 1s store bytes_out_rate(1s)
    tcp-request session track-sc0 src
    acl  over_quota sc0_bytes_out_rate gt 125000000
    tcp-request content reject if over_quota

    # ── Inject Bright Data credentials for every CONNECT ─────────────────────
    http-request set-header Proxy-Authorization \
      "Basic YnJkLWN1c3RvbWVyLWhsXzE5Y2IwZmU4LXpvbmUtYWw0LWNvdW50cnktVVMtc2Vzc2lvbi0xMjM0NTY3ODowMzVrbngzM2RtbjI="

    default_backend superproxy

###############################################################################
# Back-end  – Bright Data super-proxy
###############################################################################
backend superproxy
    mode http
    option http-keep-alive
    server brd1 brd.superproxy.io:22225
